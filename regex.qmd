# Очистка текста с помощью регулярных выражений


```{r, echo = FALSE, results='hide', message=FALSE, output=FALSE}

library(qpdf)
library(pdftools)
library(magick)
library(purrr)
library(tidyverse)
library(tidytext)
library(udpipe)
library(tesseract)

```

## Сам код

Напишем функцию, которая идет по всем папкам с картинками-текстами внутри папки Corpus, распознает их функцией ocr() с помощью модели FRA. Дальше написанная нами функция чистит текст регулярными выражениями по указанным параметрам. 

```{r, message = FALSE}

recognize_and_clean <- function(directory) {
  files_Jac <- list.files(path = directory, pattern = "png", full.names = TRUE)
  Jac_recognized <- map(files_Jac, ocr, engine = tesseract('fra'))
  text_conc_Jac <- paste(Jac_recognized, collapse = " ")
  
  text_conc_Jac_clean <- text_conc_Jac |> 
    # удаляет переносы
    str_replace_all("(?<=\\p{L})-\\s*\\n\\s*(?=\\p{L})",'') |>
    # удаляет пробел+двоеточие
    str_replace_all('\\s+:', '') |> 
    # удаляет пробел + черту вертикальную
    str_replace_all('\\s+\\|', '') |> 
    # удаляет слова из водяного знака
    str_replace_all("(?im)^.*\\b\\w*sca\\w*\\b.*$",'') |> 
    # удаляет цифры
    str_replace_all('[[:digit:]]', '') |> 
    # удаляем строки, в которых только один символ, потому что видим, что таких много 
    str_replace_all('(?m)^\\s*\\S\\s*$', '') |> 
    # удаляет переносы построчные, превращает их в пробелы
    str_replace_all("\n", " ") |>
    # схлопывает множественные пробелы до одного
    str_replace_all(" +", " ") 
}
```

Cоздаем список папок с текстами, идем по ним, распознаем тексты-картинки с французской моделькой написанной функцией, складываем в отдельные текстовые файлы.

```{r}
jaccottet_dirs <- list.files('./corpus', full.names=TRUE)
```

Проходим мапом, возвращается символьный вектор длиной 10, где каждый элемент - отдельный текст корпуса склеенный и очищенный:

```{r}
data <- map(jaccottet_dirs, recognize_and_clean)
```

Мы подготовили тексты, теперь возьмем названия папок с текстами-картинками и создадим тиббл, в котором будут в одном столбце названия произведений, в другом - сами произведения. После этого почистим названия произведений.

```{r}
jaccottet_tibble <- tibble(title = jaccottet_dirs, text = data)
jaccotet_tibble_correct_titles <- jaccottet_tibble |> 
  mutate(title = str_remove(title, "./corpus/"))
```
